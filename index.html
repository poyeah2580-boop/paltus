<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>主页界面</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Helvetica Neue', Arial, sans-serif;
            font-weight: lighter; /* 恢复细体字 */
        }
        
        body {
            background-color: #121212;
            color: #e0e0e0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            max-width: 100%;
            overflow-x: hidden;
        }
        
        .status-bar {
            background-color: #000000;
            color: white;
            padding: 0 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            height: 20px;
        }
        
        .battery {
            display: inline-flex;
            align-items: center;
        }
        
        .battery-level {
            width: 18px;
            height: 8px;
            border: 1px solid white;
            border-radius: 2px;
            margin-left: 3px;
            position: relative;
            overflow: hidden;
        }
        
        .battery-level:after {
            content: '';
            position: absolute;
            right: -2px;
            top: 1px;
            width: 1px;
            height: 3px;
            background: white;
            border-radius: 0 1px 1px 0;
        }
        
        .battery-fill {
            height: 100%;
            width: 80%;
            background: white;
        }
        
        .header {
            background-color: #1F1F1F;
            color: white;
            padding: 8px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            height: 44px;
            border-bottom: 1px solid #2A2A2A;
        }
        
        .header-id {
            margin-left: 10px;
            font-size: 16px;
            color: #FFFFFF;
            position: absolute;
            left: 50px;
        }
        
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            background-color: #121212;
        }
        
        .message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            opacity: 0;
            transform: translateY(10px);
            animation: fadeIn 0.3s forwards;
        }
        
        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .message-received {
            align-items: flex-start;
        }
        
        .message-sent {
            align-items: flex-end;
        }
        
        .message-bubble {
            max-width: 70%;
            padding: 10px 15px;
            border-radius: 18px;
            position: relative;
            font-size: 16px;
            line-height: 1.4;
            word-break: break-word;
        }
        
        .received-bubble {
            background-color: #2A2A2A;
            color: #E0E0E0;
            border-top-left-radius: 5px;
        }
        
        .sent-bubble {
            background-color: #005CFF;
            color: white;
            border-top-right-radius: 5px;
        }
        
        .input-area {
            display: flex;
            flex-direction: column;
            padding: 8px;
            background-color: #1F1F1F;
            border-top: 1px solid #2A2A2A;
        }
        
        .input-row {
            display: flex;
            margin-bottom: 8px;
        }
        
        .message-input {
            flex: 1;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            outline: none;
            font-size: 16px;
            background-color: #2A2A2A;
            color: #000000;
        }
        
        .message-input::placeholder {
            color: #9E9E9E;
        }
        
        .send-button {
            margin-left: 8px;
            padding: 0 15px;
            background-color: #005CFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .send-button:disabled {
            background-color: #9E9E9E;
            cursor: not-allowed;
        }
        
        .toolbar {
            display: flex;
            justify-content: space-between;
            padding: 0 5px;
        }
        
        .tool-button {
            background: none;
            border: none;
            color: #9E9E9E;
            padding: 8px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .icon {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #2A2A2A;
            padding: 20px;
            border-radius: 10px;
            z-index: 100;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        
        .modal-content {
            color: white;
            line-height: 1.6;
        }
        
        .modal-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .modal-close {
            margin-top: 15px;
            padding: 5px 15px;
            background-color: #005CFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        a {
            color: #4DA6FF;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="status-bar">
        <span id="current-time">20:30</span>
        <div class="battery">
            <span>85%</span>
            <div class="battery-level">
                <div class="battery-fill"></div>
            </div>
        </div>
    </div>
    
    <div class="header">
        <div style="display: flex; align-items: center;">
            <svg class="icon" viewBox="0 0 24 24">
                <path d="M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"/>
            </svg>
            <span class="header-id">PALTUS</span>
        </div>
        <svg class="icon" id="menuButton" viewBox="0 0 24 24">
            <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
        </svg>
    </div>
    
    <div class="chat-container" id="chatContainer">
        <!-- 消息将通过JavaScript动态添加 -->
    </div>
    
    <div class="input-area">
        <div class="input-row">
            <input type="text" class="message-input" id="messageInput" placeholder="输入消息...">
            <button class="send-button" id="sendButton">发送</button>
        </div>
        <div class="toolbar">
            <button class="tool-button">
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M19,11C19,14.53 16.39,17.44 13,17.93V21H11V17.93C7.61,17.44 5,14.53 5,11H7A5,5 0 0,0 12,16A5,5 0 0,0 17,11H19Z"/>
                </svg>
            </button>
            <button class="tool-button">
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="M4,4H7L9,2H15L17,4H20A2,2 0 0,1 22,6V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z"/>
                </svg>
            </button>
            <button class="tool-button">
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="M4,5H20V16H4V5M4,19H20V21H4V19M22,9.5C22,10.88 20.88,12 19.5,12C18.12,12 17,10.88 17,9.5C17,8.12 18.12,7 19.5,7C20.88,7 22,8.12 22,9.5M13,17V15H11V17H13M9.5,17L12,14.5L14.5,17H9.5M5,15H7V17H5V15Z"/>
                </svg>
            </button>
            <button class="tool-button">
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="M12,2C6.48,2 2,6.48 2,12C2,17.52 6.48,22 12,22C17.52,22 22,17.52 22,12C22,6.48 17.52,2 12,2M7,9.5C7,8.67 7.67,8 8.5,8C9.33,8 10,8.67 10,9.5C10,10.33 9.33,11 8.5,11C7.67,11 7,10.33 7,9.5M12,17.23C10.25,17.23 8.71,16.5 7.81,15.42L9.23,14C9.68,14.72 10.75,15.23 12,15.23C13.25,15.23 14.32,14.72 14.77,14L16.19,15.42C15.29,16.5 13.75,17.23 12,17.23M15.5,11C14.67,11 14,10.33 14,9.5C14,8.67 14.67,8 15.5,8C16.33,8 17,8.67 17,9.5C17,10.33 16.33,11 15.5,11Z"/>
                </svg>
            </button>
            <button class="tool-button">
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
                </svg>
            </button>
        </div>
    </div>

    <div id="keywordModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">关键词</div>
            <p>OC - 查看OC列表</p>
            <p>骰子 - 进入骰子模式</p>
        </div>
        <button class="modal-close" id="closeModal">关闭</button>
    </div>

    <script>
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const chatContainer = document.getElementById('chatContainer');
        const menuButton = document.getElementById('menuButton');
        const keywordModal = document.getElementById('keywordModal');
        const closeModal = document.getElementById('closeModal');
        
        // 对话内容
        const initialDialogue = [
            "你好，陌生的来客",
            "这里是PALTUS的界面，可以发送特定的关键词获取信息",
            "可以试试随便发点什么？"
        ];
        
        const nextDialogue = [
            "对，就是这样",
            "目前只支持转接OC网站与骰子模式",
            "demo版本之后会更新更多功能（也许）",
            "下次进来直接发送关键词即可",
            "如果你忘记了，点击右上角的标识，会显示目前支持的关键词功能"
        ];
        
        const ocResponse = [
            '<img src="https://files.catbox.moe/wjhe9s.png" alt="提示" width="200" style="height: auto;">',
            "目前支持查看",
            '<a href="https://flowus.cn/paltus/share/318a5744-64fd-4b5d-9dbe-91832612cff8" target="_blank">【家产】</a>'
        ];
        
        const diceResponse = [
            "变更为骰子模式，目前无法支持判定",
            "格式为rd（数目）"
        ];
        
        let currentDialogueIndex = 0;
        let playbackInterval = null;
        let isPlaying = false;
        let hasFirstMessage = false;
        let isDiceMode = false;
        
        function updateTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            document.getElementById('current-time').textContent = `${hours}:${minutes}`;
        }
        
        setInterval(updateTime, 1000);
        updateTime();
        
        function addMessage(text, isReceived) {
            const messageElement = document.createElement('div');
            messageElement.className = `message ${isReceived ? 'message-received' : 'message-sent'}`;
            messageElement.innerHTML = `<div class="message-bubble ${isReceived ? 'received-bubble' : 'sent-bubble'}">${text}</div>`;
            chatContainer.appendChild(messageElement);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        function sendMessage() {
            const messageText = messageInput.value.trim();
            if (messageText && !isPlaying) {
                addMessage(messageText, false);
                messageInput.value = '';
                
                if (!hasFirstMessage) {
                    hasFirstMessage = true;
                    
                    // 检查是否是关键词
                    if (messageText.toUpperCase() === 'OC') {
                        setTimeout(() => {
                            startPlayback(ocResponse);
                        }, 500);
                    } else if (messageText === '骰子') {
                        setTimeout(() => {
                            startPlayback(diceResponse);
                            isDiceMode = true;
                        }, 500);
                    } else {
                        setTimeout(() => {
                            startPlayback(nextDialogue);
                        }, 500);
                    }
                } else {
                    // 已发送过第一条消息后的处理
                    if (isDiceMode && messageText.startsWith('rd')) {
                        const diceNum = parseInt(messageText.substring(2).trim());
                        if (!isNaN(diceNum) && diceNum > 0) {
                            const result = Math.floor(Math.random() * diceNum) + 1;
                            setTimeout(() => {
                                addMessage(`骰子结果: ${result}`, true);
                            }, 500);
                        }
                    } else if (messageText.toUpperCase() === 'OC') {
                        setTimeout(() => {
                            startPlayback(ocResponse);
                        }, 500);
                    } else if (messageText === '骰子') {
                        setTimeout(() => {
                            startPlayback(diceResponse);
                            isDiceMode = true;
                        }, 500);
                    }
                }
            }
        }
        
        function startPlayback(messages) {
            if (isPlaying) return;
            
            isPlaying = true;
            sendButton.disabled = true;
            
            currentDialogueIndex = 0;
            playbackInterval = setInterval(() => {
                if (currentDialogueIndex < messages.length) {
                    addMessage(messages[currentDialogueIndex], true);
                    currentDialogueIndex++;
                } else {
                    stopPlayback();
                }
            }, 1000); // 1秒间隔
        }
        
        function stopPlayback() {
            clearInterval(playbackInterval);
            isPlaying = false;
            sendButton.disabled = false;
        }
        
        // 页面加载时自动开始播放初始对话
        window.addEventListener('load', () => {
            startPlayback(initialDialogue);
        });
        
        sendButton.addEventListener('click', sendMessage);
        
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // 右上角菜单点击事件
        menuButton.addEventListener('click', () => {
            keywordModal.style.display = 'block';
        });
        
        closeModal.addEventListener('click', () => {
            keywordModal.style.display = 'none';
        });
        
        // 点击模态框外部关闭
        window.addEventListener('click', (e) => {
            if (e.target === keywordModal) {
                keywordModal.style.display = 'none';
            }
        });
        
        // 骰子模式处理函数
        function handleDiceMode(message) {
            if (message.startsWith('rd')) {
                const diceCount = parseInt(message.substring(2).trim());
                if (!isNaN(diceCount) && diceCount > 0) {
                    const rollResult = Math.floor(Math.random() * diceCount) + 1;
                    addMessage(`骰子结果: ${rollResult}`, true);
                    return true;
                }
            }
            return false;
        }
        
        // 增强消息动画效果
        function enhanceMessageAnimation(element) {
            element.style.transition = 'all 0.3s ease-out';
            element.style.transform = 'scale(1.02)';
            setTimeout(() => {
                element.style.transform = 'scale(1)';
            }, 300);
        }
        
        // 监听所有新消息的添加
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                mutation.addedNodes.forEach((node) => {
                    if (node.classList && node.classList.contains('message')) {
                        const bubble = node.querySelector('.message-bubble');
                        if (bubble) {
                            enhanceMessageAnimation(bubble);
                        }
                    }
                });
            });
        });
        
        observer.observe(chatContainer, {
            childList: true,
            subtree: true
        });
        
        // 初始化第一条消息动画
        setTimeout(() => {
            const bubbles = document.querySelectorAll('.message-bubble');
            if (bubbles.length > 0) {
                bubbles.forEach(bubble => {
                    bubble.classList.add('show');
                    enhanceMessageAnimation(bubble);
                });
            }
        }, 500);
    </script>
</body>
</html>
